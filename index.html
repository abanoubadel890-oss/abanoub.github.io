<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عرض تقديمي: المرونة العقلية والاجتماعية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8fafc;
            height: 100dvh; 
            overflow: hidden; 
        }

        /* Animations */
        .fade-up {
            animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .point-item {
            opacity: 0;
            transform: translateX(10px);
            transition: all 0.4s ease-out;
        }
        .point-visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* Scrollbar Styling */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Print Styles */
        @media print {
            body { overflow: auto !important; background: white !important; height: auto !important; }
            #main-container, #ai-modal, .no-print { display: none !important; }
            #print-area { display: block !important; }
            .print-page { 
                page-break-after: always; 
                padding: 40px; 
                border-bottom: 1px solid #eee;
                direction: rtl;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-200 p-4 sm:p-0">

    <!-- Print Area -->
    <div id="print-area" class="hidden w-full bg-white text-black"></div>

    <!-- AI Modal -->
    <div id="ai-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm hidden transition-opacity duration-300" onclick="closeAiModal(event)">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 mx-4 relative border border-slate-100 transform transition-all scale-95 opacity-0" id="ai-modal-content">
            <div class="flex items-center gap-2 mb-4 text-indigo-700 border-b border-slate-100 pb-3">
                <span class="material-symbols-outlined">auto_awesome</span>
                <h3 class="font-bold text-lg">المستشار الذكي (Be Ready)</h3>
                <button onclick="closeAiModal()" class="mr-auto text-slate-400 hover:text-red-500 transition-colors p-1 rounded-full hover:bg-slate-100 flex items-center"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div id="ai-content" class="text-slate-700 leading-relaxed text-base font-medium min-h-[80px]"></div>
        </div>
    </div>

    <!-- Main Card -->
    <div id="main-container" class="relative w-full max-w-5xl h-[90vh] md:h-[85vh] bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden border border-slate-100 ring-1 ring-slate-900/5">
        
        <!-- Header -->
        <div class="px-6 md:px-10 pt-8 pb-4 flex justify-between items-center border-b border-slate-50 bg-white z-10 shrink-0">
            <div>
                <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-widest block mb-1">رقم الشريحة</span>
                <div class="flex items-baseline gap-2">
                    <span id="slide-number" class="text-3xl md:text-4xl font-black text-indigo-600">01</span>
                    <span class="text-sm text-slate-400 font-medium">/ 05</span>
                </div>
            </div>
            <div class="flex items-center gap-3 bg-slate-50 px-3 py-1.5 md:px-4 md:py-2 rounded-full border border-slate-100 shadow-sm">
                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0">
                    <span class="material-symbols-outlined text-lg">person</span>
                </div>
                <div>
                    <span class="block text-[10px] text-slate-400">تقديم</span>
                    <span id="presenter-name" class="block text-sm font-bold text-slate-700 leading-none">اسم المتحدث</span>
                </div>
            </div>
        </div>

        <!-- Content Body -->
        <div class="flex-1 px-6 md:px-10 py-6 overflow-y-auto custom-scroll relative bg-gradient-to-b from-white to-slate-50/50">
            <div class="max-w-4xl mx-auto pb-20"> 
                <h1 id="slide-title" class="text-3xl md:text-5xl font-black text-slate-800 mb-3 leading-tight fade-up" style="animation-delay: 0.1s;">العنوان</h1>
                <h2 id="slide-subtitle" class="text-lg md:text-xl text-indigo-500 font-medium mb-8 fade-up" style="animation-delay: 0.2s;">العنوان الفرعي</h2>
                
                <div class="grid gap-6">
                    <ul id="slide-points" class="space-y-4 md:space-y-6">
                        <!-- Points injected here -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Notes Panel -->
        <div id="notes-panel" class="absolute bottom-[80px] left-0 right-0 bg-amber-50 border-t border-amber-100 p-6 transform translate-y-[120%] transition-transform duration-300 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)] z-20 max-h-[50vh] overflow-y-auto custom-scroll">
            <div class="flex items-center gap-2 mb-3 text-amber-700 sticky top-0 bg-amber-50 pb-2 border-b border-amber-200/50">
                <span class="material-symbols-outlined text-lg">lightbulb</span>
                <span class="font-bold text-sm">ملاحظات المتحدث (من المادة التدريبية)</span>
                <button onclick="toggleNotes()" class="mr-auto text-amber-900/40 hover:text-amber-900"><span class="material-symbols-outlined text-sm">close</span></button>
            </div>
            <p id="speaker-notes" class="text-amber-900 leading-loose text-base md:text-lg whitespace-pre-line font-medium"></p>
        </div>

        <!-- Footer / Controls -->
        <div class="h-auto min-h-[80px] py-4 bg-white border-t border-slate-100 flex flex-wrap md:flex-nowrap items-center justify-between px-6 md:px-10 z-30 gap-4 shrink-0">
            <div class="flex items-center gap-2 w-full md:w-auto justify-center md:justify-start">
                <button onclick="toggleNotes()" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-slate-500 transition-colors text-xs md:text-sm font-bold group">
                    <span class="material-symbols-outlined text-lg group-hover:text-amber-500 transition-colors">description</span>
                    الملاحظات
                </button>
                <button onclick="getAiTip()" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-indigo-50 text-indigo-600 transition-colors text-xs md:text-sm font-bold border border-transparent hover:border-indigo-100">
                    <span class="material-symbols-outlined text-lg">auto_awesome</span>
                    نصيحة AI
                </button>
                <button onclick="exportToPDF()" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-rose-50 text-rose-600 transition-colors text-xs md:text-sm font-bold border border-transparent hover:border-rose-100">
                    <span class="material-symbols-outlined text-lg">picture_as_pdf</span>
                    PDF
                </button>
            </div>

            <div class="flex items-center gap-4 w-full md:w-auto justify-center">
                <button onclick="nextSlide()" id="btn-next" class="w-12 h-12 rounded-full bg-indigo-600 shadow-lg shadow-indigo-200 flex items-center justify-center text-white hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all">
                    <span class="material-symbols-outlined text-xl">arrow_forward</span>
                </button>
                
                <div class="w-20 md:w-24 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-indigo-600 w-0 transition-all duration-500 ease-out"></div>
                </div>

                <button onclick="prevSlide()" id="btn-prev" class="w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center text-slate-400 hover:bg-slate-100 hover:text-slate-800 transition-all disabled:opacity-30 disabled:cursor-not-allowed">
                    <span class="material-symbols-outlined text-xl">arrow_back</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 

        // Updated Slides based on User's Request & PDF Content
        const slides = [
            {
                id: 1,
                presenter: "مصطفى",
                title: "ما هي المرونة؟",
                subtitle: "التعريف والمفاهيم الأساسية",
                points: [
                    { text: "التعريف: القدرة على التعامل مع التغييرات والتحديات و'التعافي' في الأوقات الصعبة.", icon: "refresh" },
                    { text: "ليست مجرد تحمل: المرونة تشمل الاستباقية والعودة للحالة الطبيعية (Bouncing back).", icon: "sports_gymnastics" },
                    { text: "المخاطر: الافتقار للمرونة يؤدي للإرهاق السريع واللجوء لآليات تأقلم غير صحية.", icon: "battery_alert" },
                    { text: "الهدف: التعامل مع الضغوط دون الانكسار.", icon: "shield" }
                ],
                notes: "مصطفى: ابدأ بتعريف المادة الأساسي. ركز على كلمة 'التعافي' (Recovery). الشخص غير المرن يشعر بالإرهاق (Burnout) بسرعة. المرونة هي الدرع الذي يحميك من آليات التأقلم السيئة."
            },
            {
                id: 2,
                presenter: "أسماء",
                title: "المرونة العقلية (Mental Resilience)",
                subtitle: "تقوية العقل للتعامل مع المجهول",
                points: [
                    { text: "المفهوم: قدرة الشخص على التكيف مع التغيير وحالة 'عدم اليقين' (Uncertainty).", icon: "psychology" },
                    { text: "الآلية: استخدام القوة العقلية لحل المشكلات بدلاً من القلق منها.", icon: "extension" },
                    { text: "التفاؤل: البقاء متفائلاً والمضي قدماً حتى عند مواجهة الانتكاسات.", icon: "sunny" },
                    { text: "الشعار: اجعل عقلك أقوى (Making Your Brain Stronger).", icon: "fitness_center" }
                ],
                notes: "أسماء: ركزي هنا على الجانب الذهني. كيف نتعامل مع المجهول؟ الشخص المرن عقلياً لا يتوقف عند المشكلة، بل يشغل عقله في 'حل المشكلات'. هو متفائل ليس لأنه ينكر الواقع، بل لأنه يثق بقدرته على التعامل معه."
            },
            {
                id: 3,
                presenter: "هدير",
                title: "المرونة الاجتماعية (Social Resilience)",
                subtitle: "قوة الاتصال والانتماء",
                points: [
                    { text: "المفهوم: قدرة 'المجموعات' على التعافي معاً من المواقف الصعبة والكوارث.", icon: "groups" },
                    { text: "الدعم المتبادل: دعم الأفراد لبعضهم البعض اجتماعياً في الأزمات.", icon: "volunteer_activism" },
                    { text: "الانتماء: بناء شعور قوي بالانتماء للمجتمع (Connecting with other people).", icon: "diversity_1" },
                    { text: "الوعي: إدراك المخاطر التي تواجه المجتمع والاستعداد لها جماعياً.", icon: "crisis_alert" }
                ],
                notes: "هدير: انتقلي من 'أنا' إلى 'نحن'. المرونة الاجتماعية تعني أننا أقوى معاً. كيف نتعافى كفريق أو مجتمع؟ السر في 'الاتصال' (Connection) و'الانتماء' (Belonging)."
            },
            {
                id: 4,
                presenter: "إيمان",
                title: "صفات الشخص المرن",
                subtitle: "خلاصة السمات الأساسية",
                points: [
                    { text: "داخلياً: يمتلك 'موضع تحكم داخلي' (يتحكم في رد فعله) ولديه رؤية إيجابية عن نفسه.", icon: "person_pin" },
                    { text: "عاطفياً: ذكاء عاطفي عالٍ وقدرة على إدارة الانفعالات بفعالية.", icon: "mood" },
                    { text: "عملياً: يضع خططاً واقعية ويلتزم بها، وهو مثابر ومتواصل جيد.", icon: "route" },
                    { text: "الهوية: يرى نفسه 'مقاتلاً' (Fighter) وليس ضحية للظروف.", icon: "swords" }
                ],
                notes: "إيمان: هذه الشريحة تجمع كل شيء. أهم نقطة هي الأخيرة: 'مقاتل لا ضحية'. وأيضاً 'موضع التحكم الداخلي' (Internal Locus of Control) يعني أنه لا يلوم الظروف بل يبحث عن دوره في الحل."
            },
            {
                id: 5,
                presenter: "أبانوب",
                title: "موقف وتأثير: مثال عملي",
                subtitle: "الفرق بين المرن وغير المرن",
                points: [
                    { text: "الموقف: تغيير مفاجئ في خطة العمل أو إلغاء مشروع مهم (حالة عدم يقين).", icon: "event_busy" },
                    { text: "رد فعل غير المرن: إرهاق، لوم، شعور بالضحية، وتوقف عن العمل (النتيجة: فشل).", icon: "sentiment_dissatisfied" },
                    { text: "رد فعل المرن: تقبل الصدمة، تفعيل 'المرونة العقلية' لحل المشكلة، وطلب 'الدعم الاجتماعي'.", icon: "engineering" },
                    { text: "التأثير: المرونة تحول الأزمة إلى فرصة للتعلم والنمو (Post-traumatic growth).", icon: "trending_up" }
                ],
                notes: "أبانوب: اختم بمثال حي. تخيل أن المشروع ألغي. غير المرن سينهار. المرن سيستخدم (عقله) لإيجاد بديل، و(علاقاته) للدعم. النتيجة: الشخص المرن يخرج من الأزمة أقوى مما دخلها."
            }
        ];

        // --- Core Logic ---
        let currentIndex = 0;
        let notesOpen = false;

        const ui = {
            title: document.getElementById('slide-title'),
            subtitle: document.getElementById('slide-subtitle'),
            presenter: document.getElementById('presenter-name'),
            number: document.getElementById('slide-number'),
            points: document.getElementById('slide-points'),
            notes: document.getElementById('speaker-notes'),
            notesPanel: document.getElementById('notes-panel'),
            progress: document.getElementById('progress-bar'),
            prevBtn: document.getElementById('btn-prev'),
            nextBtn: document.getElementById('btn-next'),
            aiModal: document.getElementById('ai-modal'),
            aiModalContent: document.getElementById('ai-modal-content'),
            aiContent: document.getElementById('ai-content'),
            printArea: document.getElementById('print-area')
        };

        function renderSlide(index) {
            const slide = slides[index];
            
            ui.title.style.opacity = '0';
            ui.subtitle.style.opacity = '0';

            setTimeout(() => {
                ui.title.innerText = slide.title;
                ui.subtitle.innerText = slide.subtitle;
                ui.presenter.innerText = slide.presenter;
                ui.number.innerText = `0${slide.id}`;
                ui.notes.innerText = slide.notes;

                ui.title.classList.remove('fade-up');
                ui.subtitle.classList.remove('fade-up');
                void ui.title.offsetWidth; 
                ui.title.style.opacity = '1';
                ui.subtitle.style.opacity = '1';
                ui.title.classList.add('fade-up');
                ui.subtitle.classList.add('fade-up');
            }, 50);

            ui.points.innerHTML = '';
            slide.points.forEach((pt, i) => {
                const li = document.createElement('li');
                li.className = 'point-item flex items-start gap-4 p-4 rounded-xl bg-slate-50 hover:bg-indigo-50 border border-slate-100 hover:border-indigo-100 transition-all group cursor-default';
                li.style.transitionDelay = `${i * 100}ms`;
                
                li.innerHTML = `
                    <div class="mt-1 min-w-[40px] h-10 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-colors shadow-sm duration-300">
                        <span class="material-symbols-outlined text-xl">${pt.icon}</span>
                    </div>
                    <p class="text-slate-700 text-base md:text-lg font-semibold leading-relaxed group-hover:text-indigo-900 transition-colors">${pt.text}</p>
                `;
                ui.points.appendChild(li);
                requestAnimationFrame(() => {
                    setTimeout(() => li.classList.add('point-visible'), 50);
                });
            });

            ui.progress.style.width = `${((index + 1) / slides.length) * 100}%`;
            ui.prevBtn.disabled = index === 0;
            
            if (index === slides.length - 1) {
                ui.nextBtn.innerHTML = '<span class="material-symbols-outlined">check</span>';
                ui.nextBtn.classList.replace('bg-indigo-600', 'bg-emerald-500');
                ui.nextBtn.classList.replace('shadow-indigo-200', 'shadow-emerald-200');
                ui.nextBtn.classList.replace('hover:bg-indigo-700', 'hover:bg-emerald-600');
            } else {
                ui.nextBtn.innerHTML = '<span class="material-symbols-outlined">arrow_forward</span>';
                ui.nextBtn.classList.replace('bg-emerald-500', 'bg-indigo-600');
                ui.nextBtn.classList.replace('shadow-emerald-200', 'shadow-indigo-200');
                ui.nextBtn.classList.replace('hover:bg-emerald-600', 'hover:bg-indigo-700');
            }
        }

        function nextSlide() { if (currentIndex < slides.length - 1) { currentIndex++; renderSlide(currentIndex); } }
        function prevSlide() { if (currentIndex > 0) { currentIndex--; renderSlide(currentIndex); } }

        function toggleNotes() {
            notesOpen = !notesOpen;
            ui.notesPanel.style.transform = notesOpen ? 'translateY(0)' : 'translateY(120%)';
        }

        function exportToPDF() {
            ui.printArea.innerHTML = '';
            
            const cover = document.createElement('div');
            cover.className = 'print-page';
            cover.style.height = '100vh';
            cover.style.display = 'flex';
            cover.style.flexDirection = 'column';
            cover.style.justifyContent = 'center';
            cover.style.textAlign = 'center';
            cover.innerHTML = `
                <h1 style="font-size: 48px; margin-bottom: 20px;">كن مستعداً: Be Ready</h1>
                <h2 style="font-size: 36px; color: #4f46e5;">المرونة العقلية والاجتماعية</h2>
                <p style="font-size: 24px; color: #666; margin-top: 20px;">عرض تقديمي متخصص</p>
                <p style="margin-top: 50px;">المادة العلمية: المرونة والتعافي والاستباقية</p>
            `;
            ui.printArea.appendChild(cover);

            slides.forEach(slide => {
                const page = document.createElement('div');
                page.className = 'print-page';
                page.innerHTML = `
                    <div style="margin-bottom: 30px; border-bottom: 2px solid #4f46e5; padding-bottom: 15px;">
                        <span style="color: #999; font-size: 14px;">شريحة ${slide.id}</span>
                        <h1 style="font-size: 32px; font-weight: bold; color: #1e293b; margin: 5px 0;">${slide.title}</h1>
                        <p style="color: #6366f1; font-size: 18px; font-weight: bold;">${slide.subtitle} <span style="color:#cbd5e1">|</span> تقديم: ${slide.presenter}</p>
                    </div>
                    <ul style="list-style: none; padding: 0;">
                        ${slide.points.map(pt => `
                            <li style="margin-bottom: 15px; font-size: 16px; display: flex; align-items: flex-start; gap: 10px; color: #334155;">
                                <span style="font-size: 20px; color: #4f46e5;">•</span> 
                                <span>${pt.text}</span>
                            </li>
                        `).join('')}
                    </ul>
                    <div style="margin-top: 40px; background: #fffbeb; padding: 20px; border: 1px solid #fcd34d; border-radius: 8px;">
                        <strong style="color: #92400e; display: block; margin-bottom: 5px;">ملاحظات المتحدث:</strong>
                        <p style="color: #78350f; font-size: 14px; line-height: 1.6;">${slide.notes}</p>
                    </div>
                `;
                ui.printArea.appendChild(page);
            });
            window.print();
        }

        // --- AI Simulation Logic ---
        const mockResponses = [
            "ركز على أن المرونة تعني 'التعافي' (Recovery) وليس مجرد التحمل.",
            "في المرونة العقلية، وضح أن 'عدم اليقين' هو جزء طبيعي من الحياة.",
            "في المرونة الاجتماعية، أكد على أهمية 'الدعم المتبادل' في وقت الأزمات.",
            "في الصفات، أبرز صفة 'المقاتل' (Fighter) كأهم سمة ذهنية.",
            "في المثال، اجعل الجمهور يتخيل الموقف ليشعروا بتأثير المرونة."
        ];

        async function getAiTip() {
            ui.aiModal.classList.remove('hidden');
            setTimeout(() => {
                ui.aiModal.classList.remove('hidden');
                ui.aiModalContent.classList.remove('scale-95', 'opacity-0');
                ui.aiModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            ui.aiContent.innerHTML = `
                <div class="flex flex-col items-center justify-center py-4 gap-3">
                    <span class="material-symbols-outlined animate-spin text-3xl text-indigo-500">sync</span>
                    <p class="text-slate-400 animate-pulse text-sm">جاري تحليل المحتوى...</p>
                </div>
            `;
            
            if (!apiKey) {
                setTimeout(() => {
                    const tip = mockResponses[currentIndex] || "أنت تقوم بعمل رائع!";
                    typewriterEffect(tip);
                }, 1500);
                return;
            }

            try {
                const slide = slides[currentIndex];
                const prompt = `Based on resilience concepts: Give a short tip for presenter "${slide.presenter}" about "${slide.title}". Points: ${JSON.stringify(slide.points)}.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                typewriterEffect(text);
            } catch (e) {
                typewriterEffect(mockResponses[currentIndex]); 
            }
        }

        function typewriterEffect(text) {
            ui.aiContent.innerHTML = '';
            let i = 0;
            const type = () => {
                if (i < text.length) {
                    ui.aiContent.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 30);
                }
            };
            type();
        }

        function closeAiModal(e) {
            if (e && e.target.id !== 'ai-modal' && !e.target.closest('button')) return;
            ui.aiModalContent.classList.remove('scale-100', 'opacity-100');
            ui.aiModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                ui.aiModal.classList.add('hidden');
                ui.aiContent.innerHTML = '';
            }, 300);
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderSlide(0);
            document.addEventListener('keydown', (e) => {
                if(e.key === 'ArrowLeft') nextSlide();
                if(e.key === 'ArrowRight') prevSlide();
                if(e.key === 'Escape') closeAiModal();
            });
        });
    </script>
</body>
</html>
